!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.MultiFileUpload=t(require("react"),require("prop-types")):(e.eZ=e.eZ||{},e.eZ.modules=e.eZ.modules||{},e.eZ.modules.MultiFileUpload=t(e.React,e.PropTypes))}("undefined"!=typeof self?self:this,function(e,t){return function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=55)}({0:function(t,i){t.exports=e},1:function(e,i){e.exports=t},15:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o),l=i(2);const r=e=>{const t={className:"c-tooltip-popup",hidden:!e.visible};return n.a.createElement("div",t,n.a.createElement("div",{className:"c-tooltip-popup__header"},n.a.createElement("div",{className:"c-tooltip-popup__title"},e.title),n.a.createElement("div",{className:"c-tooltip-popup__close",onClick:e.onClose,tabIndex:"-1"},n.a.createElement(l.a,{name:"discard",extraClasses:"ez-icon--medium"}))),n.a.createElement("div",{className:"c-tooltip-popup__content"},e.children))};r.propTypes={title:s.a.string.isRequired,children:s.a.node.isRequired,visible:s.a.bool.isRequired,onClose:s.a.func},r.defaultProps={onClose:()=>{}},t.a=r},18:function(e,t,i){"use strict";t.a=(e=>{let t,i=parseInt(e,10)||0,a=0;for(;i>=1024;)i/=1024,a++;return t=a<1?0:1,i.toFixed(i>=10||t)+" "+["bytes","KB","MB","GB"][a]})},2:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o);const l=e=>{const t=e.customPath?e.customPath:"/bundles/ezplatformadminui/img/ez-icons.svg#".concat(e.name);let i="ez-icon";return e.extraClasses&&(i="".concat(i," ").concat(e.extraClasses)),n.a.createElement("svg",{className:i},n.a.createElement("use",{xlinkHref:t}))};l.propTypes={extraClasses:s.a.string.isRequired,name:s.a.string,customPath:s.a.string},l.defaultProps={customPath:null,name:null},t.a=l},55:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),n=i.n(a),o=i(1),s=i.n(o),l=i(56),r=i(61),d=i(2);function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class c extends a.Component{constructor(e){super(e);let t=!0;this._itemsUploaded=[],e.itemsToUpload&&e.itemsToUpload.length||(t=!1),this.handleDropOnWindow=this.handleDropOnWindow.bind(this),this.handleAfterUpload=this.handleAfterUpload.bind(this),this.showUploadPopup=this.showUploadPopup.bind(this),this.hidePopup=this.hidePopup.bind(this),this.processUploadedFiles=this.processUploadedFiles.bind(this),this.state={popupVisible:t,itemsToUpload:e.itemsToUpload,allowDropOnWindow:!0,uploadDisabled:Object.values(e.contentCreatePermissionsConfig).every(e=>!e)}}componentDidMount(){this.manageDropEvent()}componentDidUpdate(){this.manageDropEvent()}manageDropEvent(){const{uploadDisabled:e,popupVisible:t,itemsToUpload:i}=this.state;e||t||i.length||(window.addEventListener("drop",this.handleDropOnWindow,!1),window.addEventListener("dragover",this.preventDefaultAction,!1))}hidePopup(){this.setState(e=>Object.assign({},e,{popupVisible:!1})),this.props.onPopupClose(this._itemsUploaded)}showUploadPopup(){this.setState(e=>Object.assign({},e,{popupVisible:!0,itemsToUpload:[]}))}handleAfterUpload(e){this._itemsUploaded=e}handleDropOnWindow(e){this.preventDefaultAction(e);const t=this.processUploadedFiles(e);this.state.allowDropOnWindow&&t.length&&(window.removeEventListener("drop",this.handleDropOnWindow,!1),window.removeEventListener("dragover",this.preventDefaultAction,!1),this.setState(e=>Object.assign({},e,{itemsToUpload:t,popupVisible:!0,allowDropOnWindow:!1})))}extractDroppedFilesList(e){let t;return t=e.nativeEvent?e.nativeEvent.dataTransfer||e.nativeEvent.target:e.dataTransfer}processUploadedFiles(e){const t=this.extractDroppedFilesList(e);return Array.from(t.files).map(e=>({id:Math.floor(Math.random()*Date.now()),file:e}))}preventDefaultAction(e){e.preventDefault(),e.stopPropagation()}renderBtn(){if(!this.props.withUploadButton)return null;const e=this.state.uploadDisabled,t={className:"m-mfu__btn--upload",title:Translator.trans("multi_file_upload_open_btn.label",{},"multi_file_upload"),onClick:this.showUploadPopup,type:"button"};return e&&(delete t.onClick,t.disabled=!0),n.a.createElement("button",t,n.a.createElement(d.a,{name:"upload",extraClasses:"ez-icon--light ez-icon--small-medium"}))}renderPopup(){if(!this.state.popupVisible)return null;const e=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){p(e,t,i[t])})}return e}({},this.props,{visible:!0,onClose:this.hidePopup,itemsToUpload:this.state.itemsToUpload,onAfterUpload:this.handleAfterUpload,preventDefaultAction:this.preventDefaultAction,processUploadedFiles:this.processUploadedFiles});return n.a.createElement(l.a,e)}render(){return n.a.createElement("div",{className:"m-mfu"},this.renderBtn(),this.renderPopup())}}t.default=c,eZ.addConfig("modules.MultiFileUpload",c),c.propTypes={adminUiConfig:s.a.shape({multiFileUpload:s.a.shape({defaultMappings:s.a.arrayOf(s.a.object).isRequired,fallbackContentType:s.a.object.isRequired,locationMappings:s.a.arrayOf(s.a.object).isRequired,maxFileSize:s.a.number.isRequired}).isRequired,token:s.a.string.isRequired,siteaccess:s.a.string.isRequired}).isRequired,parentInfo:s.a.shape({contentTypeIdentifier:s.a.string.isRequired,contentTypeId:s.a.number.isRequired,locationPath:s.a.string.isRequired,language:s.a.string.isRequired}).isRequired,checkCanUpload:s.a.func,createFileStruct:s.a.func,deleteFile:s.a.func,onPopupClose:s.a.func,publishFile:s.a.func,itemsToUpload:s.a.array,withUploadButton:s.a.bool,contentCreatePermissionsConfig:s.a.object,contentTypesMap:s.a.object.isRequired,currentLanguage:s.a.string},c.defaultProps={checkCanUpload:r.a,createFileStruct:r.b,deleteFile:r.c,onPopupClose:()=>{},publishFile:r.d,itemsToUpload:[],withUploadButton:!0,currentLanguage:""}},56:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o),l=i(15),r=i(57),d=i(58);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const u="ez-scroll-disabled";class h extends a.Component{constructor(e){super(e),this.uploadFiles=this.uploadFiles.bind(this),this.state={itemsToUpload:e.itemsToUpload}}componentDidMount(){window.document.body.classList.add(u)}componentWillUnmount(){window.document.body.classList.remove(u)}UNSAFE_componentWillReceiveProps(e){this.setState(t=>{return{itemsToUpload:[...t.itemsToUpload.filter(t=>!e.itemsToUpload.find(e=>e.id===t.id)),...e.itemsToUpload]}})}uploadFiles(e){this.setState(()=>({itemsToUpload:e}))}render(){const e=this.props,t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){c(e,t,i[t])})}return e}({},e,{itemsToUpload:this.state.itemsToUpload}),i=Translator.trans("upload_popup.title",{},"multi_file_upload");return n.a.createElement("div",{className:"c-upload-popup"},n.a.createElement(l.a,p({title:i},e),n.a.createElement(r.a,{onDrop:this.uploadFiles,maxFileSize:this.props.adminUiConfig.multiFileUpload.maxFileSize,preventDefaultAction:this.props.preventDefaultAction,processUploadedFiles:this.props.processUploadedFiles}),n.a.createElement(d.a,t)))}}t.a=h,h.propTypes={popupTitle:s.a.string.isRequired,visible:s.a.bool,onUpload:s.a.func,onUploadEnd:s.a.func,onUploadFail:s.a.func,onItemEdit:s.a.func,onItemRemove:s.a.func,onClose:s.a.func,itemsToUpload:s.a.array,onAfterUpload:s.a.func.isRequired,createFileStruct:s.a.func.isRequired,publishFile:s.a.func.isRequired,deleteFile:s.a.func.isRequired,checkCanUpload:s.a.func.isRequired,adminUiConfig:s.a.shape({multiFileUpload:s.a.shape({defaultMappings:s.a.arrayOf(s.a.object).isRequired,fallbackContentType:s.a.object.isRequired,locationMappings:s.a.arrayOf(s.a.object).isRequired,maxFileSize:s.a.number.isRequired}).isRequired,token:s.a.string.isRequired,siteaccess:s.a.string.isRequired}).isRequired,parentInfo:s.a.shape({contentTypeIdentifier:s.a.string.isRequired,contentTypeId:s.a.number.isRequired,locationPath:s.a.string.isRequired,language:s.a.string.isRequired}).isRequired,preventDefaultAction:s.a.func.isRequired,processUploadedFiles:s.a.func.isRequired,contentTypesMap:s.a.object.isRequired,currentLanguage:s.a.string},h.defaultProps={visible:!0,itemsToUpload:[],currentLanguage:""}},57:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o),l=i(18),r=i(2);class d extends a.Component{constructor(e){super(e),this._refFileInput=null,this.openFileSelector=this.openFileSelector.bind(this),this.handleUpload=this.handleUpload.bind(this)}openFileSelector(e){e.preventDefault(),this._refFileInput.click()}handleUpload(e){this.props.preventDefaultAction(e),this.props.onDrop(this.props.processUploadedFiles(e))}componentDidMount(){window.addEventListener("drop",this.props.preventDefaultAction,!1),window.addEventListener("dragover",this.props.preventDefaultAction,!1)}componentWillUnmount(){window.removeEventListener("drop",this.props.preventDefaultAction,!1),window.removeEventListener("dragover",this.props.preventDefaultAction,!1)}render(){const e=Translator.trans("max_file_size.message",{},"multi_file_upload"),t=Translator.trans("drop_action.message",{},"multi_file_upload"),i=Translator.trans("upload_btn.label",{},"multi_file_upload");return n.a.createElement("form",{className:"c-drop-area",multiple:!0,onDrop:this.handleUpload},n.a.createElement("div",{className:"c-drop-area__message c-drop-area__message--main"},t),n.a.createElement("div",{className:"c-drop-area__btn-select",onClick:this.openFileSelector,tabIndex:"-1"},n.a.createElement(r.a,{name:"upload",extraClasses:"c-drop-area__icon ez-icon--light ez-icon--small-medium"}),i),n.a.createElement("div",{className:"c-drop-area__message c-drop-area__message--filesize"},"(",e," ",Object(l.a)(this.props.maxFileSize),")"),n.a.createElement("input",{className:"c-drop-area__input--hidden",ref:e=>this._refFileInput=e,id:"mfu-files",type:"file",name:"files[]",hidden:!0,multiple:!0,onChange:this.handleUpload}))}}t.a=d,d.propTypes={onDrop:s.a.func.isRequired,maxFileSize:s.a.number.isRequired,processUploadedFiles:s.a.func.isRequired,preventDefaultAction:s.a.func.isRequired}},58:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o),l=i(59);class r extends a.Component{constructor(e){super(e),this.state={itemsToUpload:e.itemsToUpload,items:[]}}UNSAFE_componentWillReceiveProps(e){this.setState(t=>{return{itemsToUpload:[...t.itemsToUpload.filter(t=>!e.itemsToUpload.find(e=>e.id===t.id)),...e.itemsToUpload]}})}componentDidUpdate(){this.props.onAfterUpload(this.state.items)}handleAfterUpload(e){this.setState(t=>({itemsToUpload:t.itemsToUpload.filter(t=>t.id!==e.id),items:[...t.items,e]}))}handleAfterAbort(e){this.setState(t=>{const i=t.items.filter(t=>t.id!==e.id),a=t.itemsToUpload.filter(t=>t.id!==e.id);return Object.assign({},t,{uploaded:i.length,total:i.length+a.length,itemsToUpload:a,items:i})})}handleAfterDelete(e){this.setState(t=>{const i=t.items.filter(t=>t.id!==e.id),a=t.itemsToUpload.filter(t=>t.id!==e.id);return Object.assign({},t,{uploaded:i.length,total:i.length+a.length,itemsToUpload:a,items:i})})}renderItemToUpload(e){return this.renderItem(e,{isUploaded:!1,createFileStruct:this.props.createFileStruct,publishFile:this.props.publishFile,onAfterAbort:this.handleAfterAbort.bind(this),onAfterUpload:this.handleAfterUpload.bind(this),checkCanUpload:this.props.checkCanUpload})}renderUploadedItem(e){return this.renderItem(e,{isUploaded:!0,deleteFile:this.props.deleteFile,onAfterDelete:this.handleAfterDelete.bind(this)})}renderItem(e,t){const{adminUiConfig:i,parentInfo:a,contentCreatePermissionsConfig:o,contentTypesMap:s,currentLanguage:r}=this.props,d=Object.assign({key:e.id,data:e,adminUiConfig:i,parentInfo:a,contentCreatePermissionsConfig:o,contentTypesMap:s,currentLanguage:r},t);return n.a.createElement(l.a,d)}render(){const{items:e,itemsToUpload:t}=this.state,i=e.length,a=i+t.length;return n.a.createElement("div",{className:"c-upload-list"},n.a.createElement("div",{className:"c-upload-list__title"},this.props.uploadedItemsListTitle," (",i,"/",a,")"),n.a.createElement("div",{className:"c-upload-list__items"},t.map(this.renderItemToUpload.bind(this)),e.map(this.renderUploadedItem.bind(this))))}}t.a=r,r.propTypes={itemsToUpload:s.a.arrayOf(s.a.object),onAfterUpload:s.a.func.isRequired,createFileStruct:s.a.func.isRequired,publishFile:s.a.func.isRequired,deleteFile:s.a.func.isRequired,checkCanUpload:s.a.func.isRequired,adminUiConfig:s.a.shape({multiFileUpload:s.a.shape({defaultMappings:s.a.arrayOf(s.a.object).isRequired,fallbackContentType:s.a.object.isRequired,locationMappings:s.a.arrayOf(s.a.object).isRequired,maxFileSize:s.a.number.isRequired}).isRequired,token:s.a.string.isRequired,siteaccess:s.a.string.isRequired}).isRequired,parentInfo:s.a.shape({contentTypeIdentifier:s.a.string.isRequired,contentTypeId:s.a.number.isRequired,locationPath:s.a.string.isRequired,language:s.a.string.isRequired}).isRequired,uploadedItemsListTitle:s.a.string.isRequired,contentCreatePermissionsConfig:s.a.object.isRequired,contentTypesMap:s.a.object.isRequired,currentLanguage:s.a.string},r.defaultProps={itemsToUpload:[],currentLanguage:""}},59:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o),l=i(60),r=i(18),d=i(2);function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){c(e,t,i[t])})}return e}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class u extends a.Component{constructor(e){super(e),this.handleFileSizeNotAllowed=this.handleFileSizeNotAllowed.bind(this),this.handleFileTypeNotAllowed=this.handleFileTypeNotAllowed.bind(this),this.handleContentTypeNotAllowed=this.handleContentTypeNotAllowed.bind(this),this.handleEditBtnClick=this.handleEditBtnClick.bind(this),this.handleUploadAbort=this.handleUploadAbort.bind(this),this.handleUploadError=this.handleUploadError.bind(this),this.handleUploadLoad=this.handleUploadLoad.bind(this),this.handleUploadProgress=this.handleUploadProgress.bind(this),this.handleUploadEnd=this.handleUploadEnd.bind(this),this.handleLoadStart=this.handleLoadStart.bind(this),this.handleFileDeleted=this.handleFileDeleted.bind(this),this.abortUploading=this.abortUploading.bind(this),this.deleteFile=this.deleteFile.bind(this),this.contentInfoInput=null,this.contentVersionInfoInput=null,this.contentVersionNoInput=null,this.contentEditBtn=null,this.state={uploading:!1,uploaded:e.isUploaded,disallowed:!1,disallowedType:!1,disallowedSize:!1,disallowedContentType:!1,aborted:!1,failed:!1,deleted:!1,progress:0,xhr:null,struct:e.data.struct||null,totalSize:Object(r.a)(e.data.file.size),uploadedSize:"0"}}componentDidMount(){const{data:e,adminUiConfig:t,parentInfo:i,createFileStruct:a,isUploaded:n,checkCanUpload:o,contentCreatePermissionsConfig:s,currentLanguage:l}=this.props;if(this.contentInfoInput=window.document.querySelector("#form_subitems_content_edit_content_info"),this.contentVersionInfoInput=window.document.querySelector("#form_subitems_content_edit_version_info_content_info"),this.contentVersionNoInput=window.document.querySelector("#form_subitems_content_edit_version_info_version_no"),this.contentEditBtn=window.document.querySelector("#form_subitems_content_edit_create"),n)return;const r=p({},t.multiFileUpload,{contentCreatePermissionsConfig:s}),d={fileTypeNotAllowedCallback:this.handleFileTypeNotAllowed,fileSizeNotAllowedCallback:this.handleFileSizeNotAllowed,contentTypeNotAllowedCallback:this.handleContentTypeNotAllowed};o(e.file,i,r,d)?a(e.file,{parentInfo:i,config:t,languageCode:l}).then(this.initPublishFile.bind(this,t)):this.setState(()=>({uploading:!1,disallowed:!0,uploaded:!1,aborted:!1,failed:!0}))}initPublishFile({token:e,siteaccess:t},i){this.props.publishFile({struct:i,token:e,siteaccess:t},{upload:{onabort:this.handleUploadAbort,onerror:this.handleUploadError,onload:this.handleUploadLoad,onprogress:this.handleUploadProgress},onloadstart:this.handleLoadStart,onerror:this.handleUploadError},this.handleUploadEnd)}handleFileTypeNotAllowed(){this.setState(()=>({uploading:!1,disallowed:!0,disallowedType:!0,disallowedSize:!1,disallowedContentType:!1,uploaded:!1,aborted:!1,failed:!0}))}handleFileSizeNotAllowed(){this.setState(()=>({uploading:!1,disallowed:!0,disallowedType:!1,disallowedSize:!0,disallowedContentType:!1,uploaded:!1,aborted:!1,failed:!0}))}handleContentTypeNotAllowed(){this.setState(()=>({uploading:!1,disallowed:!0,disallowedType:!1,disallowedSize:!1,disallowedContentType:!0,uploaded:!1,aborted:!1,failed:!0}))}handleLoadStart(e){this.setState(()=>({uploading:!0,disallowed:!1,disallowedType:!1,disallowedSize:!1,disallowedContentType:!1,uploaded:!1,aborted:!1,failed:!1,xhr:e.target}))}handleUploadAbort(){this.setState(()=>({uploading:!1,disallowed:!1,disallowedType:!1,disallowedSize:!1,disallowedContentType:!1,uploaded:!1,aborted:!0,failed:!1}))}handleUploadError(){this.setState(e=>({uploading:!1,disallowed:e.disallowed,disallowedSize:e.disallowedSize,disallowedType:e.disallowedType,disallowedContentType:e.disallowedContentType,uploaded:!1,aborted:e.aborted,failed:!0}))}handleUploadLoad(){this.setState(()=>({uploading:!1,disallowed:!1,disallowedType:!1,disallowedSize:!1,disallowedContentType:!1,uploaded:!0,aborted:!1,failed:!1}))}handleUploadProgress(e){const t=e.loaded/e.total,i=parseInt(100*t,10);this.setState(()=>({uploadedSize:Object(r.a)(t*parseInt(this.props.data.file.size,10)),uploading:!0,disallowed:!1,disallowedType:!1,disallowedSize:!1,disallowedContentType:!1,uploaded:!1,aborted:!1,failed:!1,progress:i}))}handleUploadEnd(){this.setState(e=>{return{struct:JSON.parse(e.xhr.response),uploading:!1,disallowed:!1,disallowedType:!1,disallowedSize:!1,disallowedContentType:!1,uploaded:!0,aborted:!1,failed:!1}},()=>{const e=this.props.data;this.props.onAfterUpload(p({},e,{struct:this.state.struct}))})}abortUploading(){this.state.xhr.abort(),this.props.onAfterAbort(this.props.data)}deleteFile(){this.setState(()=>({deleted:!0}),()=>this.props.deleteFile(this.props.adminUiConfig,this.state.struct,this.handleFileDeleted))}handleFileDeleted(){this.props.onAfterDelete(this.props.data)}getContentTypeIdentifier(){const{contentTypesMap:e,data:t}=this.props;if(!t.struct||!t.struct.Content)return null;const i=t.struct.Content.ContentType._href,a=e?e[i]:null;return a?a.identifier:null}renderIcon(){const e=this.getContentTypeIdentifier();if(!e)return null;const t=eZ.helpers.contentType.getContentTypeIconUrl(e);return n.a.createElement(d.a,{customPath:t,extraClasses:"ez-icon--small-medium"})}renderProgressBar(){const{uploaded:e,aborted:t,progress:i,totalSize:a,uploadedSize:o,disallowed:s}=this.state;return this.props.isUploaded||e||t||s?null:n.a.createElement(l.a,{progress:i,uploaded:o,total:a})}renderErrorMessage(){const{uploaded:e,aborted:t,disallowedType:i,disallowedSize:a,failed:o,uploading:s,disallowedContentType:l}=this.state,r=!e&&!t&&(a||i||l)&&o&&!s,d=Translator.trans("cannot_upload.message",{},"multi_file_upload"),p=Translator.trans("disallowed_type.message",{},"multi_file_upload"),c=Translator.trans("disallowed_size.message",{},"multi_file_upload"),u=Translator.trans("disallowed_content_type.message",{},"multi_file_upload");let h=d;return i&&(h=p),a&&(h=c),l&&(h=u),r?n.a.createElement("div",{className:"c-upload-list-item__message c-upload-list-item__message--error"},h):null}renderSuccessMessage(){const{uploaded:e,aborted:t,disallowedSize:i,disallowedType:a,failed:o,uploading:s}=this.state,l=e&&!t&&!(i||a)&&!o&&!s,r=Translator.trans("upload.success.message",{},"multi_file_upload");return l?n.a.createElement("div",{className:"c-upload-list-item__message c-upload-list-item__message--success"},r):null}renderAbortBtn(){const{uploaded:e,aborted:t,disallowedSize:i,disallowedType:a,failed:o,uploading:s}=this.state;if(!(!e&&!t&&!i&&!a&&!o&&s))return null;const l=Translator.trans("abort.label",{},"multi_file_upload");return n.a.createElement("div",{className:"c-upload-list-item__action c-upload-list-item__action--abort",onClick:this.abortUploading,title:l,tabIndex:"-1"},n.a.createElement(d.a,{name:"circle-close",extraClasses:"ez-icon--small-medium"}))}handleEditBtnClick(e){e.preventDefault();const{struct:t}=this.state,i=t.Content,a=i._id,n=i.CurrentVersion.Version.VersionInfo.VersionTranslationInfo.Language[0].languageCode,o=i.CurrentVersion.Version.VersionInfo.versionNo;this.contentInfoInput.value=a,this.contentVersionInfoInput.value=a,this.contentVersionNoInput.value=o,window.document.querySelector("#form_subitems_content_edit_language_".concat(n)).checked=!0,this.contentEditBtn.click()}renderEditBtn(){const{uploaded:e,aborted:t,disallowedSize:i,disallowedType:a,failed:o,uploading:s}=this.state;if(!(this.props.isUploaded||e&&!t&&!(i||a)&&!o&&!s))return null;const l=Translator.trans("edit.label",{},"multi_file_upload");return n.a.createElement("div",{className:"c-upload-list-item__action c-upload-list-item__action--edit",title:l,onClick:this.handleEditBtnClick,tabIndex:"-1"},n.a.createElement(d.a,{name:"edit",extraClasses:"ez-icon--small-medium"}))}renderDeleteBtn(){const{uploaded:e,aborted:t,disallowedSize:i,disallowedType:a,failed:o,uploading:s}=this.state;if(!(this.props.isUploaded||e&&!t&&!(i||a)&&!o&&!s))return null;const l=Translator.trans("delete.label",{},"multi_file_upload");return n.a.createElement("div",{className:"c-upload-list-item__action c-upload-list-item__action--delete",onClick:this.deleteFile,title:l,tabIndex:"-1"},n.a.createElement(d.a,{name:"trash",extraClasses:"ez-icon--small-medium"}))}render(){return this.state.deleted?null:n.a.createElement("div",{className:"c-upload-list-item"},n.a.createElement("div",{className:"c-upload-list-item__icon-wrapper"},this.renderIcon()),n.a.createElement("div",{className:"c-upload-list-item__meta"},n.a.createElement("div",{className:"c-upload-list-item__name"},this.props.data.file.name),n.a.createElement("div",{className:"c-upload-list-item__size"},this.state.uploaded?this.state.totalSize:"")),n.a.createElement("div",{className:"c-upload-list-item__info"},this.renderErrorMessage(),this.renderSuccessMessage(),this.renderProgressBar()),n.a.createElement("div",{className:"c-upload-list-item__actions"},this.renderAbortBtn(),this.renderEditBtn(),this.renderDeleteBtn()))}}t.a=u,u.propTypes={data:s.a.object.isRequired,onAfterUpload:s.a.func.isRequired,onAfterAbort:s.a.func.isRequired,onAfterDelete:s.a.func.isRequired,isUploaded:s.a.bool.isRequired,createFileStruct:s.a.func.isRequired,publishFile:s.a.func.isRequired,deleteFile:s.a.func.isRequired,checkCanUpload:s.a.func.isRequired,adminUiConfig:s.a.shape({multiFileUpload:s.a.shape({defaultMappings:s.a.arrayOf(s.a.object).isRequired,fallbackContentType:s.a.object.isRequired,locationMappings:s.a.arrayOf(s.a.object).isRequired,maxFileSize:s.a.number.isRequired}).isRequired,token:s.a.string.isRequired,siteaccess:s.a.string.isRequired}).isRequired,parentInfo:s.a.shape({contentTypeIdentifier:s.a.string.isRequired,contentTypeId:s.a.number.isRequired,locationPath:s.a.string.isRequired,language:s.a.string.isRequired}).isRequired,contentCreatePermissionsConfig:s.a.object,contentTypesMap:s.a.object.isRequired,currentLanguage:s.a.string},u.defaultProps={isUploaded:!1,currentLanguage:""}},60:function(e,t,i){"use strict";var a=i(0),n=i.n(a),o=i(1),s=i.n(o);const l=e=>n.a.createElement("div",{className:"c-progress-bar"},n.a.createElement("div",{className:"c-progress-bar__value",style:{width:"".concat(e.progress,"%")}}),n.a.createElement("div",{className:"c-progress-bar__label"},"".concat(e.progress,"%")),n.a.createElement("div",{className:"c-progress-bar__uploaded"},e.uploaded," of ",e.total));l.propTypes={progress:s.a.number.isRequired,uploaded:s.a.string.isRequired,total:s.a.string.isRequired},t.a=l},61:function(e,t,i){"use strict";const a=e=>{if(!e.ok)throw Error(e.text());return e},n=(e,t)=>e.find(e=>e.mimeTypes.find(e=>e===t.type)),o=(e,t)=>!t||((e,t)=>!!n(e,t))(t.mappings,e),s=(e,t,i)=>{const a=i.locationMappings.find(e=>e.contentTypeIdentifier===t.contentTypeIdentifier),o=a?a.mappings:i.defaultMappings;return n(o,e)||i.fallbackContentType},l=({parentInfo:e,config:t,languageCode:i},n)=>{let o="/api/ezp/v2/content/locations".concat(e.locationPath);o=o.endsWith("/")?o.slice(0,-1):o;const l=s(n.file,e,t.multiFileUpload);return(({token:e,siteaccess:t},i)=>{const n=new Request("/api/ezp/v2/content/types?identifier=".concat(i),{method:"GET",headers:{Accept:"application/vnd.ez.api.ContentTypeInfoList+json","X-Siteaccess":t,"X-CSRF-Token":e},credentials:"same-origin",mode:"cors"});return fetch(n).then(a)})(t,l.contentTypeIdentifier).then(e=>e.json()).catch(()=>window.eZ.helpers.notification.showErrorNotification("Cannot get content type by identifier")).then(t=>{const a=[{fieldDefinitionIdentifier:l.nameFieldIdentifier,fieldValue:n.file.name},{fieldDefinitionIdentifier:l.contentFieldIdentifier,fieldValue:{fileName:n.file.name,data:n.fileReader.result.replace(/^.*;base64,/,"")}}];return{ContentCreate:{ContentType:{_href:t.ContentTypeInfoList.ContentType[0]._href},mainLanguageCode:i||e.language,LocationCreate:{ParentLocation:{_href:o},sortField:"PATH",sortOrder:"ASC"},Section:null,alwaysAvailable:!0,remoteId:null,modificationDate:(new Date).toISOString(),fields:{field:a}}}}).catch(()=>window.eZ.helpers.notification.showErrorNotification("Cannot create content structure"))},r=({struct:e,token:t,siteaccess:i},a)=>{const n=new XMLHttpRequest,o=JSON.stringify(e),s={Accept:"application/vnd.ez.api.Content+json","Content-Type":"application/vnd.ez.api.ContentCreate+json","X-CSRF-Token":t,"X-Siteaccess":i};return new Promise((e,t)=>{if(n.open("POST","/api/ezp/v2/content/objects",!0),n.onreadystatechange=((e,t,i)=>{4===e.readyState&&(0===e.status&&""===e.statusText||(e.status>=400||!e.status?i(e):t(JSON.parse(e.response))))}).bind(null,n,e,t),a&&Object.keys(a).length){const e=a.upload;e&&Object.keys(e).length&&(n.upload.onabort=e.onabort,n.upload.onerror=t,n.upload.onload=e.onload,n.upload.onprogress=e.onprogress,n.upload.ontimeout=e.ontimeout),n.onerror=t,n.onloadstart=a.onloadstart}for(let e in s)s.hasOwnProperty(e)&&n.setRequestHeader(e,s[e]);n.send(o)})};t.a=((e,t,i,a)=>{const n=i.locationMappings.find(e=>e.contentTypeIdentifier===t.contentTypeIdentifier);return((e,t,i)=>{if(!i.hasOwnProperty("contentCreatePermissionsConfig")||!i.contentCreatePermissionsConfig)return!0;const a=s(e,t,i);return i.contentCreatePermissionsConfig[a.contentTypeIdentifier]})(e,t,i)?o(e,n)?!(e.size>i.maxFileSize&&(a.fileSizeNotAllowedCallback(),1)):(a.fileTypeNotAllowedCallback(),!1):(a.contentTypeNotAllowedCallback(),!1)});t.b=((e,t)=>new Promise(function(e,t,i){this.addEventListener("load",()=>t({fileReader:this,file:e}),!1),this.addEventListener("error",()=>i(),!1),this.readAsDataURL(e)}.bind(new FileReader,e)).then(l.bind(null,t)));t.d=((e,t,i)=>{r(e,t).then((({token:e,siteaccess:t},i)=>{if(!i||!i.hasOwnProperty("Content"))return Promise.reject("Cannot publish content based on an uploaded file");const n=new Request(i.Content.CurrentVersion.Version._href,{method:"POST",headers:{"X-Siteaccess":t,"X-CSRF-Token":e,"X-HTTP-Method-Override":"PUBLISH"},mode:"cors",credentials:"same-origin"});return fetch(n).then(a)}).bind(null,e)).then(i).catch(()=>window.eZ.helpers.notification.showErrorNotification("An error occurred while publishing a file"))});t.c=(({token:e,siteaccess:t},i,n)=>{const o=new Request(i.Content._href,{method:"DELETE",headers:{"X-Siteaccess":t,"X-CSRF-Token":e},mode:"cors",credentials:"same-origin"});fetch(o).then(a).then(n).catch(()=>window.eZ.helpers.notification.showErrorNotification("An error occurred while deleting a file"))})}}).default});
//# sourceMappingURL=MultiFileUpload.module.js.map
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.ContentTree=t(require("react"),require("prop-types")):(e.eZ=e.eZ||{},e.eZ.modules=e.eZ.modules||{},e.eZ.modules.ContentTree=t(e.React,e.PropTypes))}("undefined"!=typeof self?self:this,function(e,t){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=60)}({0:function(t,s){t.exports=e},1:function(e,s){e.exports=t},2:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(s(0)),n=a(s(1));function a(e){return e&&e.__esModule?e:{default:e}}const o=e=>{const t=e.customPath?e.customPath:`/bundles/ezplatformadminui/img/ez-icons.svg#${e.name}`;let s="ez-icon";return e.extraClasses&&(s=`${s} ${e.extraClasses}`),i.default.createElement("svg",{className:s},i.default.createElement("use",{xlinkHref:t}))};o.propTypes={extraClasses:n.default.string.isRequired,name:n.default.string,customPath:n.default.string},o.defaultProps={customPath:null,name:null},t.default=o},3:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getBasicRequestInit=(({token:e,siteaccess:t})=>({headers:{"X-Siteaccess":t,"X-CSRF-Token":e},mode:"same-origin",credentials:"same-origin"}));const i=t.handleRequestError=(e=>{if(!e.ok)throw Error(e.statusText);return e});t.handleRequestResponse=(e=>i(e).json()),t.handleRequestResponseStatus=(e=>i(e).status)},4:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=t.NOTIFICATION_INFO_LABEL="info",n=t.NOTIFICATION_SUCCESS_LABEL="success",a=t.NOTIFICATION_WARNING_LABEL="warning",o=t.NOTIFICATION_ERROR_LABEL="danger",r=t.showNotification=(e=>{const t=new CustomEvent("ez-notify",{detail:e});document.body.dispatchEvent(t)});t.showInfoNotification=(e=>{r({message:e,label:i})}),t.showSuccessNotification=(e=>{r({message:e,label:n})}),t.showWarningNotification=(e=>{r({message:e,label:a})}),t.showErrorNotification=(e=>{const t=e instanceof Error?e.message:e;r({message:t,label:o})})},60:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(0),n=d(i),a=d(s(1)),o=d(s(61)),r=s(64);function d(e){return e&&e.__esModule?e:{default:e}}const l=(e,t)=>{const s=1===t.length,i=e.find(e=>e.locationId===parseInt(t[0],10));return i?s?i:i.hasOwnProperty("subitems")&&Array.isArray(i.subitems)?(t.shift(),l(i.subitems,t)):null:null};class u extends i.Component{constructor(e){super(e),this.setInitialItemsState=this.setInitialItemsState.bind(this),this.loadMoreSubitems=this.loadMoreSubitems.bind(this),this.items=e.preloadedLocations}componentDidMount(){this.items.length||(0,r.loadLocationItems)(this.props.rootLocationId,this.setInitialItemsState)}setInitialItemsState(e){this.items=[e],this.forceUpdate()}loadMoreSubitems({parentLocationId:e,offset:t,limit:s,path:i},n){(0,r.loadLocationItems)(e,this.updateLocationsStateAfterLoadingMoreItems.bind(this,i,n),s,t)}updateLocationsStateAfterLoadingMoreItems(e,t,s){const i=l(this.items,e.split(","));i&&(i.subitems=[...i.subitems,...s.subitems],t(),this.forceUpdate())}render(){const e={items:this.items,currentLocationId:this.props.currentLocationId,loadMoreSubitems:this.loadMoreSubitems};return n.default.createElement(o.default,e)}}t.default=u,eZ.addConfig("modules.ContentTree",u),u.propTypes={rootLocationId:a.default.number.isRequired,currentLocationId:a.default.number.isRequired,preloadedLocations:a.default.arrayOf(a.default.object)},u.defaultProps={rootLocationId:2,preloadedLocations:[]}},61:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(0),n=r(i),a=r(s(1)),o=r(s(62));function r(e){return e&&e.__esModule?e:{default:e}}const d="ez-is-tree-resizing";class l extends i.Component{constructor(e){super(e),this.changeContainerWidth=this.changeContainerWidth.bind(this),this.addWidthChangeListener=this.addWidthChangeListener.bind(this),this.removeWidthChangeListener=this.removeWidthChangeListener.bind(this),this._refTreeContainer=n.default.createRef(),this.state={resizeStartPositionX:0,containerWidth:0,resizedContainerWidth:0,isResizing:!1}}componentWillUnmount(){this.clearDocumentResizingState()}changeContainerWidth({clientX:e}){const t=e;this.setState(e=>({resizedContainerWidth:e.containerWidth+(t-e.resizeStartPositionX)}))}addWidthChangeListener({nativeEvent:e}){const t=e.clientX,s=parseInt(window.getComputedStyle(this._refTreeContainer.current).width,10);window.document.addEventListener("mousemove",this.changeContainerWidth,!1),window.document.addEventListener("mouseup",this.removeWidthChangeListener,!1),window.document.body.classList.add(d),this.setState(()=>({resizeStartPositionX:t,containerWidth:s,isResizing:!0}))}removeWidthChangeListener(){this.clearDocumentResizingState(),this.setState(e=>({resizeStartPositionX:0,containerWidth:e.resizedContainerWidth,isResizing:!1}))}clearDocumentResizingState(){window.document.removeEventListener("mousemove",this.changeContainerWidth),window.document.removeEventListener("mouseup",this.removeWidthChangeListener),window.document.body.classList.remove(d)}render(){var e=this.state;const t=e.isResizing,s=e.containerWidth,i=e.resizedContainerWidth;var a=this.props;const r=a.items,d=a.loadMoreSubitems,l=a.currentLocationId,u=t?i:s,c=r.length?r[0].subitems:[],h=r.length?""+r[0].locationId:"",m={className:"m-tree",ref:this._refTreeContainer},f={items:c,path:h,loadMoreSubitems:d,currentLocationId:l};return u&&(m.style={width:`${u}px`}),n.default.createElement("div",m,n.default.createElement(o.default,f),n.default.createElement("div",{className:"m-tree__resize-handler",onMouseDown:this.addWidthChangeListener}))}}t.default=l,l.propTypes={items:a.default.array.isRequired,loadMoreSubitems:a.default.func.isRequired,currentLocationId:a.default.number.isRequired}},62:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},n=r(s(0)),a=r(s(1)),o=r(s(63));function r(e){return e&&e.__esModule?e:{default:e}}const d=({items:e,loadMoreSubitems:t,currentLocationId:s,path:a})=>{const r={loadMoreSubitems:t,currentLocationId:s},l={loadMoreSubitems:t};return n.default.createElement("ul",{className:"c-list"},e.map(e=>{const t=`${a&&a.length?a+",":""}${e.locationId}`,u=e.subitems,c=e.href,h=e.name,m=e.locationId,f=e.contentTypeIdentifier,p=e.isInvisible,b=e.totalSubitemsCount;return n.default.createElement(o.default,i({subitems:u,href:c,name:h,locationId:m,contentTypeIdentifier:f,isInvisible:p,totalSubitemsCount:b},l,{key:e.locationId,selected:e.locationId===s,path:t}),u.length?n.default.createElement(d,i({path:t,items:u},r)):null)}))};d.propTypes={path:a.default.string.isRequired,items:a.default.array.isRequired,loadMoreSubitems:a.default.func.isRequired,currentLocationId:a.default.number.isRequired},t.default=d},63:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(0),n=r(i),a=r(s(1)),o=r(s(2));function r(e){return e&&e.__esModule?e:{default:e}}class d extends i.Component{constructor(e){super(e),this.toggleExpandedState=this.toggleExpandedState.bind(this),this.cancelLoadingState=this.cancelLoadingState.bind(this),this.loadMoreSubitems=this.loadMoreSubitems.bind(this),this.handleAfterExpandedStateChange=this.handleAfterExpandedStateChange.bind(this),this.state={isExpanded:!1,isLoading:!1}}cancelLoadingState(){this.setState(()=>({isLoading:!1}))}toggleExpandedState(){this.setState((e,t)=>{const s=!e.isExpanded&&t.totalSubitemsCount>t.subitems.length;return{isExpanded:!e.isExpanded,isLoading:s}},this.handleAfterExpandedStateChange)}handleAfterExpandedStateChange(){this.props.totalSubitemsCount!==this.props.subitems.length&&(this.state.isLoading?this.loadMoreSubitems():console.log("TODO: Think about killing a request with AbortController"))}loadMoreSubitems(){var e=this.props;const t=e.subitems,s=e.path,i=e.locationId,n=e.loadMoreSubitems;this.setState(()=>({isLoading:!0}),()=>n({path:s,parentLocationId:i,offset:t.length,limit:10},this.cancelLoadingState))}checkCanLoadMore(){var e=this.props;const t=e.subitems,s=e.totalSubitemsCount;return t.length<s}renderIcon(){var e=this.props;const t=e.contentTypeIdentifier,s={extraClasses:`ez-icon--small ez-icon--${e.selected?"light":"dark"}`};return this.state.isLoading?(s.name="spinner",s.extraClasses=`${s.extraClasses} ez-spin`):s.customPath=eZ.helpers.contentType.getContentTypeIconUrl(t)||eZ.helpers.contentType.getContentTypeIconUrl("file"),n.default.createElement("span",{className:"c-list-item__icon"},n.default.createElement(o.default,s))}renderLoadMoreBtn(){let e=null;if(!this.state.isExpanded||!this.checkCanLoadMore())return null;this.state.isLoading&&(e=n.default.createElement(o.default,{name:"spinner",extraClasses:"ez-spin ez-icon--small ez-icon--dark c-list-item__load-more-btn-spinner"}));const t=Translator.trans("content_tree_list.item.load_more",{},"universal_discovery_widget");return n.default.createElement("button",{type:"button",className:"c-list-item__load-more-btn btn ez-btn",onClick:this.loadMoreSubitems},e," ",t)}render(){var e=this.props;const t=e.totalSubitemsCount,s=e.children,i=e.isInvisible,a=e.selected,o=e.href,r=e.name,d={className:"c-list-item"},l={className:"c-list-item__toggler",onClick:this.toggleExpandedState,hidden:!t,tabIndex:-1};return t&&(d.className=`${d.className} c-list-item--has-sub-items`),this.checkCanLoadMore()&&(d.className=`${d.className} c-list-item--can-load-more`),this.state.isExpanded&&(d.className=`${d.className} c-list-item--is-expanded`),i&&(d.className=`${d.className} c-list-item--is-hidden`),a&&(d.className=`${d.className} c-list-item--is-selected`,l.className=`${l.className} c-list-item__toggler--light`),n.default.createElement("li",d,n.default.createElement("div",{className:"c-list-item__label"},n.default.createElement("span",l),n.default.createElement("a",{className:"c-list-item__link",href:o},this.renderIcon()," ",r)),s,this.renderLoadMoreBtn())}}d.propTypes={path:a.default.string.isRequired,href:a.default.string.isRequired,contentTypeIdentifier:a.default.string.isRequired,totalSubitemsCount:a.default.number.isRequired,subitems:a.default.array.isRequired,children:a.default.element,hidden:a.default.bool.isRequired,isContainer:a.default.bool.isRequired,selected:a.default.bool.isRequired,locationId:a.default.number.isRequired,name:a.default.string.isRequired,loadMoreSubitems:a.default.func.isRequired},d.defaultProps={hidden:!1},t.default=d},64:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadLocationItems=void 0;var i=s(3),n=s(4);t.loadLocationItems=((e,t,s=50,o=0)=>{const r=new Request(`/api/ezp/v2/location/tree/load-subitems/${e}/${s}/${o}`,{method:"GET",mode:"same-origin",credentials:"same-origin",headers:{Accept:"application/vnd.ez.api.ContentTreeNode+json"}});fetch(r).then(i.handleRequestResponse).then(e=>{const t=e.ContentTreeNode;for(let e=0;e<t.children.length;++e)t.children[e]=a(t.children[e]);return a(t)}).then(t).catch(n.showErrorNotification)});const a=e=>(e.totalSubitemsCount=e.totalChildrenCount,e.subitems=e.children,delete e.totalChildrenCount,delete e.children,e)}}).default});
//# sourceMappingURL=ContentTree.module.js.map
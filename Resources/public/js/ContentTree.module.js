!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.ContentTree=t(require("react"),require("prop-types")):(e.eZ=e.eZ||{},e.eZ.modules=e.eZ.modules||{},e.eZ.modules.ContentTree=t(e.React,e.PropTypes))}("undefined"!=typeof self?self:this,function(e,t){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=62)}({0:function(t,i){t.exports=e},1:function(e,i){e.exports=t},2:function(e,t,i){"use strict";var s=i(0),n=i.n(s),r=i(1),a=i.n(r);const o=e=>{const t=e.customPath?e.customPath:"/bundles/ezplatformadminui/img/ez-icons.svg#".concat(e.name);let i="ez-icon";return e.extraClasses&&(i="".concat(i," ").concat(e.extraClasses)),n.a.createElement("svg",{className:i},n.a.createElement("use",{xlinkHref:t}))};o.propTypes={extraClasses:a.a.string.isRequired,name:a.a.string,customPath:a.a.string},o.defaultProps={customPath:null,name:null},t.a=o},3:function(e,t,i){"use strict";t.a=(({token:e,siteaccess:t})=>({headers:{"X-Siteaccess":t,"X-CSRF-Token":e},mode:"same-origin",credentials:"same-origin"}));const s=e=>{if(!e.ok)throw Error(e.statusText);return e};t.b=s;t.c=(e=>s(e).json());t.d=(e=>s(e).status)},4:function(e,t,i){"use strict";const s=e=>{const t=new CustomEvent("ez-notify",{detail:e});document.body.dispatchEvent(t)};t.a=(e=>{const t=e instanceof Error?e.message:e;s({message:t,label:"danger"})})},62:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),n=i.n(s),r=i(1),a=i.n(r),o=i(63),c=i(66);const d="ez-content-tree-subtrees";class l extends s.Component{constructor(e){super(e),this.setInitialItemsState=this.setInitialItemsState.bind(this),this.loadMoreSubitems=this.loadMoreSubitems.bind(this),this.updateSubtreeAfterItemToggle=this.updateSubtreeAfterItemToggle.bind(this),this.handleCollapseAllItems=this.handleCollapseAllItems.bind(this),this.limitSubitemsInSubtree=this.limitSubitemsInSubtree.bind(this),this.refreshContentTree=this.refreshContentTree.bind(this);try{const t=this.readSubtree();this.items=e.preloadedLocations,this.subtree=t||this.generateInitialSubtree(),this.expandCurrentLocationInSubtree(),this.clipTooDeepSubtreeBranches(this.subtree[0],e.treeMaxDepth-1),this.subtree[0].children.forEach(this.limitSubitemsInSubtree),this.saveSubtree()}catch(e){this.items=[],this.subtree=this.generateInitialSubtree(),this.saveSubtree()}}componentDidMount(){if(document.body.addEventListener("ez-content-tree-refresh",this.refreshContentTree,!1),this.items.length)return this.subtree=this.generateSubtree(this.items,!0),void this.saveSubtree();Object(c.b)(this.props.restInfo,this.subtree,e=>{this.setInitialItemsState(e[0])})}setInitialItemsState(e){this.items=[e],this.subtree=this.generateSubtree(this.items,!0),this.saveSubtree(),this.forceUpdate()}loadMoreSubitems({parentLocationId:e,offset:t,limit:i,path:s},n){Object(c.a)(this.props.restInfo,e,this.updateLocationsStateAfterLoadingMoreItems.bind(this,s,n),i,t)}refreshContentTree(){this.items=[],this.forceUpdate(),Object(c.b)(this.props.restInfo,this.subtree,e=>{this.setInitialItemsState(e[0])})}updateLocationsStateAfterLoadingMoreItems(e,t,i){const s=this.findItem(this.items,e.split(","));s&&(s.subitems=[...s.subitems,...i.subitems],this.updateSubtreeAfterLoadMoreItems(e),t(),this.forceUpdate())}updateSubtreeAfterLoadMoreItems(e){const t=this.findItem(this.items,e.split(","));this.updateItemInSubtree(this.subtree[0],t,e.split(",")),this.saveSubtree()}updateSubtreeAfterItemToggle(e,t){const i=this.findItem(this.items,e.split(","));t?this.addItemToSubtree(this.subtree[0],i,e.split(",")):this.removeItemFromSubtree(this.subtree[0],i,e.split(",")),this.saveSubtree()}addItemToSubtree(e,t,i){const s=this.findParentSubtree(e,i);if(!s)return;const{subitemsLoadLimit:n,subitemsLimit:r}=this.props,a=Math.ceil(t.subitems.length/n)*n;s.children.push({"_media-type":"application/vnd.ez.api.ContentTreeLoadSubtreeRequestNode",locationId:t.locationId,limit:Math.min(r,a),offset:0,children:[]})}removeItemFromSubtree(e,t,i){const s=this.findParentSubtree(e,i);if(!s)return;const n=s.children.findIndex(e=>e.locationId===t.locationId);n>-1&&s.children.splice(n,1)}updateItemInSubtree(e,t,i){const s=this.findParentSubtree(e,i);if(!s)return;const n=s.children.findIndex(e=>e.locationId===t.locationId);n>-1&&(s.children[n].limit=t.subitems.length)}readSubtree(){const{rootLocationId:e,userId:t}=this.props,i=localStorage.getItem(d),s=i?JSON.parse(i):null,n=s?s[t]:null,r=n?n[e]:null;return r?JSON.parse(r):null}saveSubtree(){const{rootLocationId:e,userId:t}=this.props,i=localStorage.getItem(d),s=i?JSON.parse(i):{};s[t]||(s[t]={}),s[t][e]=JSON.stringify(this.subtree),localStorage.setItem(d,JSON.stringify(s))}findParentSubtree(e,t){if(!(t.length<2))return t.shift(),t.pop(),t.reduce((e,t)=>e.children.find(e=>e.locationId===parseInt(t,10)),e)}expandCurrentLocationInSubtree(){const{rootLocationId:e,currentLocationPath:t}=this.props,i=t.split("/").filter(e=>!!e),s=i.findIndex(t=>parseInt(t,10)===e);if(-1===s)return;const n=i.slice(s-i.length+1),r=n.slice(0,n.length-1);this.expandPathInSubtree(this.subtree[0],r)}expandPathInSubtree(e,t){if(!t.length)return;const i=parseInt(t[0],10);let s=e.children.find(e=>e.locationId===i);s||(s={"_media-type":"application/vnd.ez.api.ContentTreeLoadSubtreeRequestNode",locationId:i,limit:this.props.subitemsLimit,offset:0,children:[]},e.children.push(s)),t.shift(),this.expandPathInSubtree(s,t)}clipTooDeepSubtreeBranches(e,t){t<=0?e.children=[]:e.children.forEach(e=>this.clipTooDeepSubtreeBranches(e,t-1))}limitSubitemsInSubtree(e){e.limit=Math.min(this.props.subitemsLimit,e.limit),e.children.forEach(this.limitSubitemsInSubtree)}generateInitialSubtree(){return[{"_media-type":"application/vnd.ez.api.ContentTreeLoadSubtreeRequestNode",locationId:this.props.rootLocationId,limit:this.props.subitemsLoadLimit,offset:0,children:[]}]}generateSubtree(e,t){const i=[],{subitemsLoadLimit:s,subitemsLimit:n}=this.props;for(const r of e){const e=r.subitems.length;if(!!e||t){const t=e?Math.ceil(e/s)*s:s;i.push({"_media-type":"application/vnd.ez.api.ContentTreeLoadSubtreeRequestNode",locationId:r.locationId,limit:Math.min(n,t),offset:0,children:this.generateSubtree(r.subitems,!1)})}}return i}findItem(e,t){const i=1===t.length,s=e.find(e=>e.locationId===parseInt(t[0],10));return s?i?s:s.hasOwnProperty("subitems")&&Array.isArray(s.subitems)?(t.shift(),this.findItem(s.subitems,t)):null:null}getCurrentLocationId(){const e=this.props.currentLocationPath.split("/").filter(e=>!!e).pop();return parseInt(e,10)}handleCollapseAllItems(){this.items=[],this.forceUpdate(),this.subtree=this.generateInitialSubtree(),this.saveSubtree(),Object(c.b)(this.props.restInfo,this.subtree,e=>{this.setInitialItemsState(e[0])})}render(){const{subitemsLimit:e,subitemsLoadLimit:t,treeMaxDepth:i}=this.props,s={items:this.items,currentLocationId:this.getCurrentLocationId(),subitemsLimit:e,subitemsLoadLimit:t,treeMaxDepth:i,loadMoreSubitems:this.loadMoreSubitems,afterItemToggle:this.updateSubtreeAfterItemToggle,onCollapseAllItems:this.handleCollapseAllItems};return n.a.createElement(o.a,s)}}t.default=l,eZ.addConfig("modules.ContentTree",l),l.propTypes={rootLocationId:a.a.number.isRequired,currentLocationPath:a.a.number.isRequired,userId:a.a.number.isRequired,preloadedLocations:a.a.arrayOf(a.a.object),subitemsLimit:a.a.number.isRequired,subitemsLoadLimit:a.a.number.isRequired,treeMaxDepth:a.a.number.isRequired,restInfo:a.a.shape({token:a.a.string.isRequired,siteaccess:a.a.string.isRequired}).isRequired},l.defaultProps={preloadedLocations:[],rootLocationId:window.eZ.adminUiConfig.contentTree.treeRootLocationId,subitemsLimit:window.eZ.adminUiConfig.contentTree.childrenLoadMaxLimit,subitemsLoadLimit:window.eZ.adminUiConfig.contentTree.loadMoreLimit,treeMaxDepth:window.eZ.adminUiConfig.contentTree.treeMaxDepth}},63:function(e,t,i){"use strict";var s=i(0),n=i.n(s),r=i(1),a=i.n(r),o=i(64),c=i(2);const d="ez-is-tree-resizing";class l extends s.Component{constructor(e){super(e),this.changeContainerWidth=this.changeContainerWidth.bind(this),this.addWidthChangeListener=this.addWidthChangeListener.bind(this),this.handleResizeEnd=this.handleResizeEnd.bind(this),this._refTreeContainer=n.a.createRef(),this.state={resizeStartPositionX:0,containerWidth:0,resizedContainerWidth:0,isResizing:!1}}componentWillUnmount(){this.clearDocumentResizingListeners()}changeContainerWidth({clientX:e}){const t=e;this.setState(e=>({resizedContainerWidth:e.containerWidth+(t-e.resizeStartPositionX)}))}addWidthChangeListener({nativeEvent:e}){const t=e.clientX,i=this._refTreeContainer.current.getBoundingClientRect().width;window.document.addEventListener("mousemove",this.changeContainerWidth,!1),window.document.addEventListener("mouseup",this.handleResizeEnd,!1),window.document.body.classList.add(d),this.setState(()=>({resizeStartPositionX:t,containerWidth:i,isResizing:!0}))}handleResizeEnd(){this.clearDocumentResizingListeners(),this.setState(e=>({resizeStartPositionX:0,containerWidth:e.resizedContainerWidth,isResizing:!1}))}clearDocumentResizingListeners(){window.document.removeEventListener("mousemove",this.changeContainerWidth),window.document.removeEventListener("mouseup",this.handleResizeEnd),window.document.body.classList.remove(d)}renderNoSubitemMessage(){const{items:e}=this.props,t=e[0],i=t,s=Translator.trans("no_subitems",{},"content_tree");if(!(!i||t.subitems&&t.subitems.length))return n.a.createElement("div",{className:"m-tree__no-items-message"},s)}renderCollapseAllBtn(){const e=Translator.trans("collapse_all",{},"content_tree");return n.a.createElement("div",{tabIndex:-1,className:"m-tree__collapse-all-btn",onClick:this.props.onCollapseAllItems},e)}renderList(){const{items:e}=this.props;if(!e||!e.length)return;const{loadMoreSubitems:t,currentLocationId:i,subitemsLoadLimit:s,subitemsLimit:r,treeMaxDepth:a,afterItemToggle:c}=this.props,d={items:e,path:"",loadMoreSubitems:t,currentLocationId:i,subitemsLimit:r,subitemsLoadLimit:s,treeMaxDepth:a,afterItemToggle:c,isRoot:!0};return n.a.createElement("div",{className:"m-tree__scrollable-wrapper"},n.a.createElement(o.a,d))}renderLoadingSpinner(){const{items:e}=this.props;if(!e||!e.length)return n.a.createElement("div",{className:"m-tree__loading-spinner"},n.a.createElement(c.a,{name:"spinner",extraClasses:"ez-icon--medium ez-spin"}))}render(){const{isResizing:e,containerWidth:t,resizedContainerWidth:i}=this.state,s=e?i:t,r={className:"m-tree",ref:this._refTreeContainer};return s&&(r.style={width:"".concat(s,"px")}),n.a.createElement("div",r,this.renderNoSubitemMessage(),this.renderList(),this.renderLoadingSpinner(),this.renderCollapseAllBtn(),n.a.createElement("div",{className:"m-tree__resize-handler",onMouseDown:this.addWidthChangeListener}))}}t.a=l,l.propTypes={items:a.a.array.isRequired,loadMoreSubitems:a.a.func.isRequired,currentLocationId:a.a.number.isRequired,subitemsLimit:a.a.number.isRequired,subitemsLoadLimit:a.a.number,treeMaxDepth:a.a.number.isRequired,afterItemToggle:a.a.func.isRequired,onCollapseAllItems:a.a.func.isRequired}},64:function(e,t,i){"use strict";var s=i(0),n=i.n(s),r=i(1),a=i.n(r),o=i(65);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}function d(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const l=({items:e,loadMoreSubitems:t,currentLocationId:i,path:s,subitemsLoadLimit:r,subitemsLimit:a,treeMaxDepth:u,afterItemToggle:m,isRoot:h})=>{const p={loadMoreSubitems:t,subitemsLoadLimit:r,subitemsLimit:a,treeMaxDepth:u,afterItemToggle:m},b=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},s=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),s.forEach(function(t){d(e,t,i[t])})}return e}({},p,{currentLocationId:i}),f=p;return n.a.createElement("ul",{className:"c-list"},e.map(e=>{const t=s&&s.length,r=window.Routing.generate("_ezpublishLocation",{locationId:e.locationId}),a="".concat(t?s+",":"").concat(e.locationId),{subitems:d}=e;return n.a.createElement(o.a,c({},e,f,{key:e.locationId,selected:e.locationId===i,href:r,isRootItem:h,path:a}),d.length?n.a.createElement(l,c({path:a,items:d,isRoot:!1},b)):null)}))};l.propTypes={path:a.a.string.isRequired,items:a.a.array.isRequired,loadMoreSubitems:a.a.func.isRequired,currentLocationId:a.a.number.isRequired,subitemsLimit:a.a.number.isRequired,subitemsLoadLimit:a.a.number,treeMaxDepth:a.a.number.isRequired,afterItemToggle:a.a.func.isRequired,isRoot:a.a.bool.isRequired},l.defaultProps={isRoot:!1},t.a=l},65:function(e,t,i){"use strict";var s=i(0),n=i.n(s),r=i(1),a=i.n(r),o=i(2);class c extends s.Component{constructor(e){super(e),this.toggleExpandedState=this.toggleExpandedState.bind(this),this.cancelLoadingState=this.cancelLoadingState.bind(this),this.loadMoreSubitems=this.loadMoreSubitems.bind(this),this.handleAfterExpandedStateChange=this.handleAfterExpandedStateChange.bind(this),this.state={isExpanded:!!e.subitems.length,isLoading:!1}}cancelLoadingState(){this.setState(()=>({isLoading:!1}))}toggleExpandedState(){const{path:e,treeMaxDepth:t}=this.props;if(e.split(",").length-1>=t){const e=Translator.trans("expand_item.limit.message",{},"content_tree");window.eZ.helpers.notification.showWarningNotification(e)}else this.setState(e=>({isExpanded:!e.isExpanded}),()=>{const{afterItemToggle:e,path:t}=this.props;e(t,this.state.isExpanded),this.handleAfterExpandedStateChange()})}handleAfterExpandedStateChange(){this.state.isExpanded&&!this.props.subitems.length&&this.loadMoreSubitems()}loadMoreSubitems(){const{subitems:e,subitemsLimit:t}=this.props,i=e.length>=t;if(this.state.isLoading||i)return;const{path:s,locationId:n,subitemsLoadLimit:r,loadMoreSubitems:a}=this.props;this.setState(()=>({isLoading:!0}),()=>a({path:s,parentLocationId:n,offset:e.length,limit:r},this.cancelLoadingState))}checkCanLoadMore(){const{subitems:e,totalSubitemsCount:t}=this.props;return e.length<t}renderIcon(){const{contentTypeIdentifier:e,selected:t}=this.props,i={extraClasses:"ez-icon--small ez-icon--".concat(t?"light":"dark")};return!this.state.isLoading||this.props.subitems.length?i.customPath=eZ.helpers.contentType.getContentTypeIconUrl(e)||eZ.helpers.contentType.getContentTypeIconUrl("file"):(i.name="spinner",i.extraClasses="".concat(i.extraClasses," ez-spin")),n.a.createElement("span",{className:"c-list-item__icon"},n.a.createElement(o.a,i))}renderLoadMoreBtn(){const{subitems:e,subitemsLimit:t}=this.props,i=e.length>=t;if(!this.state.isExpanded||i||!this.checkCanLoadMore()||!e.length)return null;const{isLoading:s}=this.state,r=Translator.trans("show_more",{},"content_tree"),a=Translator.trans("loading_more",{},"content_tree"),c=s?a:r;let d=null;return s&&(d=n.a.createElement(o.a,{name:"spinner",extraClasses:"ez-spin ez-icon--small c-list-item__load-more-btn-spinner"})),n.a.createElement("button",{type:"button",className:"c-list-item__load-more-btn btn ez-btn",onClick:this.loadMoreSubitems},d," ",c)}renderSubitemsLimitReachedInfo(){const{subitems:e,subitemsLimit:t}=this.props,i=e.length>=t;if(!this.state.isExpanded||!i)return null;const s=Translator.trans("show_more.limit_reached",{},"content_tree");return n.a.createElement("div",{className:"c-list-item__load-more-limit-info"},s)}renderItemLabel(){if(this.props.isRootItem)return null;const{totalSubitemsCount:e,href:t,name:i,selected:s}=this.props,r={className:"c-list-item__toggler",onClick:this.toggleExpandedState,hidden:!e,tabIndex:-1};return s&&(r.className="".concat(r.className," ").concat("c-list-item__toggler","--light")),n.a.createElement("div",{className:"c-list-item__label"},n.a.createElement("span",r),n.a.createElement("a",{className:"c-list-item__link",href:t},this.renderIcon()," ",i))}render(){const{totalSubitemsCount:e,children:t,isInvisible:i,selected:s}=this.props,r={className:"c-list-item"};return e&&(r.className="".concat(r.className," ").concat("c-list-item","--has-sub-items")),this.checkCanLoadMore()&&(r.className="".concat(r.className," ").concat("c-list-item","--can-load-more")),this.state.isExpanded&&(r.className="".concat(r.className," ").concat("c-list-item","--is-expanded")),i&&(r.className="".concat(r.className," ").concat("c-list-item","--is-hidden")),s&&(r.className="".concat(r.className," ").concat("c-list-item","--is-selected")),this.props.isRootItem&&(r.className="".concat(r.className," ").concat("c-list-item","--is-root-item")),n.a.createElement("li",r,this.renderItemLabel(),t,this.renderLoadMoreBtn(),this.renderSubitemsLimitReachedInfo())}}c.propTypes={path:a.a.string.isRequired,href:a.a.string.isRequired,contentTypeIdentifier:a.a.string.isRequired,totalSubitemsCount:a.a.number.isRequired,subitems:a.a.array.isRequired,children:a.a.element,hidden:a.a.bool.isRequired,isContainer:a.a.bool.isRequired,selected:a.a.bool.isRequired,locationId:a.a.number.isRequired,name:a.a.string.isRequired,isInvisible:a.a.bool.isRequired,loadMoreSubitems:a.a.func.isRequired,subitemsLimit:a.a.number.isRequired,subitemsLoadLimit:a.a.number,treeMaxDepth:a.a.number.isRequired,afterItemToggle:a.a.func.isRequired,isRootItem:a.a.bool.isRequired},c.defaultProps={hidden:!1,isRootItem:!1},t.a=c},66:function(e,t,i){"use strict";var s=i(3),n=i(4);t.a=(({siteaccess:e},t,i,r=50,o=0)=>{const c=new Request("".concat("/api/ezp/v2/location/tree/load-subitems","/").concat(t,"/").concat(r,"/").concat(o),{method:"GET",mode:"same-origin",credentials:"same-origin",headers:{Accept:"application/vnd.ez.api.ContentTreeNode+json","X-Siteaccess":e}});fetch(c).then(s.c).then(e=>{const t=e.ContentTreeNode;return t.children=t.children.map(a),a(t)}).then(i).catch(n.a)});t.b=(({token:e,siteaccess:t},i,a)=>{const o=new Request("".concat("/api/ezp/v2/location/tree/load-subtree"),{method:"POST",mode:"same-origin",credentials:"same-origin",body:JSON.stringify({LoadSubtreeRequest:{"_media-type":"application/vnd.ez.api.ContentTreeLoadSubtreeRequest",nodes:i}}),headers:{Accept:"application/vnd.ez.api.ContentTreeRoot+json","Content-Type":"application/vnd.ez.api.ContentTreeLoadSubtreeRequest+json","X-Siteaccess":t,"X-CSRF-Token":e}});fetch(o).then(s.c).then(e=>{const t=e.ContentTreeRoot.ContentTreeNodeList;return r(t)}).then(a).catch(n.a)});const r=e=>e.map(e=>(a(e),e.subitems=r(e.subitems),e)),a=e=>(e.totalSubitemsCount=e.totalChildrenCount,e.subitems=e.children,delete e.totalChildrenCount,delete e.children,delete e.displayLimit,e)}}).default});
//# sourceMappingURL=ContentTree.module.js.map
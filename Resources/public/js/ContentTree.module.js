!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.ContentTree=t(require("react"),require("prop-types")):(e.eZ=e.eZ||{},e.eZ.modules=e.eZ.modules||{},e.eZ.modules.ContentTree=t(e.React,e.PropTypes))}("undefined"!=typeof self?self:this,function(e,t){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=60)}({0:function(t,i){t.exports=e},1:function(e,i){e.exports=t},2:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}const a=e=>{const t=e.customPath?e.customPath:`/bundles/ezplatformadminui/img/ez-icons.svg#${e.name}`;let i="ez-icon";return e.extraClasses&&(i=`${i} ${e.extraClasses}`),s.default.createElement("svg",{className:i},s.default.createElement("use",{xlinkHref:t}))};a.propTypes={extraClasses:n.default.string.isRequired,name:n.default.string,customPath:n.default.string},a.defaultProps={customPath:null,name:null},t.default=a},3:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getBasicRequestInit=(({token:e,siteaccess:t})=>({headers:{"X-Siteaccess":t,"X-CSRF-Token":e},mode:"same-origin",credentials:"same-origin"}));const s=t.handleRequestError=(e=>{if(!e.ok)throw Error(e.statusText);return e});t.handleRequestResponse=(e=>s(e).json()),t.handleRequestResponseStatus=(e=>s(e).status)},4:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=e=>{let t;if("object"!=typeof e)return e;if(!e)return e;if("[object Array]"===Object.prototype.toString.apply(e)){t=[];for(let i=0;i<e.length;i++)t[i]=s(e[i]);return t}t={};for(let i in e)e.hasOwnProperty(i)&&(t[i]=s(e[i]));return t};t.default=s},5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=t.NOTIFICATION_INFO_LABEL="info",n=t.NOTIFICATION_SUCCESS_LABEL="success",o=t.NOTIFICATION_WARNING_LABEL="warning",a=t.NOTIFICATION_ERROR_LABEL="danger",r=t.showNotification=(e=>{const t=new CustomEvent("ez-notify",{detail:e});document.body.dispatchEvent(t)});t.showInfoNotification=(e=>{r({message:e,label:s})}),t.showSuccessNotification=(e=>{r({message:e,label:n})}),t.showWarningNotification=(e=>{r({message:e,label:o})}),t.showErrorNotification=(e=>{const t=e instanceof Error?e.message:e;r({message:t,label:a})})},60:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),n=d(s),o=d(i(1)),a=d(i(61)),r=i(64);d(i(4));function d(e){return e&&e.__esModule?e:{default:e}}class l extends s.Component{constructor(e){super(e),this.setInitialItemsState=this.setInitialItemsState.bind(this),this.loadMoreSubitems=this.loadMoreSubitems.bind(this),this.items=e.preloadedLocations}componentDidMount(){this.items.length||(0,r.loadLocationItems)(this.props.rootLocationId,this.setInitialItemsState)}setInitialItemsState(e){this.items=[e],this.forceUpdate()}loadMoreSubitems({parentLocationId:e,offset:t,limit:i,path:s},n){(0,r.loadLocationItems)(e,this.updateLocationsStateAfterLoadingMoreItems.bind(this,s,n),i,t)}updateLocationsStateAfterLoadingMoreItems(e,t,i){console.log("updateLocationsStateAfterLoadingMoreItems",{location:i,path:e}),t()}render(){const e={items:this.items,currentLocationId:this.props.currentLocationId,loadMoreSubitems:this.loadMoreSubitems};return n.default.createElement(a.default,e)}}t.default=l,l.propTypes={rootLocationId:o.default.number.isRequired,currentLocationId:o.default.number.isRequired,preloadedLocations:o.default.arrayOf(o.default.object)},l.defaultProps={rootLocationId:2,preloadedLocations:[]}},61:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),n=r(s),o=r(i(1)),a=r(i(62));function r(e){return e&&e.__esModule?e:{default:e}}const d="ez-is-tree-resizing";class l extends s.Component{constructor(e){super(e),this.changeContainerWidth=this.changeContainerWidth.bind(this),this.addWidthChangeListener=this.addWidthChangeListener.bind(this),this.removeWidthChangeListener=this.removeWidthChangeListener.bind(this),this._refTreeContainer=n.default.createRef(),this.state={resizeStartPositionX:0,containerWidth:0,resizedContainerWidth:0,isResizing:!1}}componentWillUnmount(){this.clearDocumentResizingState()}changeContainerWidth({clientX:e}){const t=e;this.setState(e=>({resizedContainerWidth:e.containerWidth+(t-e.resizeStartPositionX)}))}addWidthChangeListener({nativeEvent:e}){const t=e.clientX,i=parseInt(window.getComputedStyle(this._refTreeContainer.current).width,10);window.document.addEventListener("mousemove",this.changeContainerWidth,!1),window.document.addEventListener("mouseup",this.removeWidthChangeListener,!1),window.document.body.classList.add(d),this.setState(()=>({resizeStartPositionX:t,containerWidth:i,isResizing:!0}))}removeWidthChangeListener(){this.clearDocumentResizingState(),this.setState(e=>({resizeStartPositionX:0,containerWidth:e.resizedContainerWidth,isResizing:!1}))}clearDocumentResizingState(){window.document.removeEventListener("mousemove",this.changeContainerWidth),window.document.removeEventListener("mouseup",this.removeWidthChangeListener),window.document.body.classList.remove(d)}render(){var e=this.state;const t=e.isResizing,i=e.containerWidth,s=e.resizedContainerWidth;var o=this.props;const r=o.items,d=o.loadMoreSubitems,l=o.currentLocationId,u=t?s:i,c={className:"m-tree",ref:this._refTreeContainer},h={items:r,loadMoreSubitems:d,currentLocationId:l};return u&&(c.style={width:`${u}px`}),n.default.createElement("div",c,n.default.createElement(a.default,h),n.default.createElement("div",{className:"m-tree__resize-handler",onMouseDown:this.addWidthChangeListener}))}}t.default=l,l.propTypes={items:o.default.array.isRequired,loadMoreSubitems:o.default.func.isRequired,currentLocationId:o.default.number.isRequired}},62:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},n=r(i(0)),o=r(i(1)),a=r(i(63));function r(e){return e&&e.__esModule?e:{default:e}}const d=({items:e,loadMoreSubitems:t,currentLocationId:i,path:o})=>{const r={loadMoreSubitems:t,currentLocationId:i},l={loadMoreSubitems:t};return n.default.createElement("ul",{className:"c-list"},e.map(e=>{const t=`${o&&o.length?o+",":""}${e.locationId}`;return n.default.createElement(a.default,s({},e,l,{key:e.locationId,selected:e.locationId===i,path:t}),e.subitems.length?n.default.createElement(d,s({path:t,items:e.subitems},r)):null)}))};d.propTypes={path:o.default.string.isRequired,items:o.default.array.isRequired,loadMoreSubitems:o.default.func.isRequired,currentLocationId:o.default.number.isRequired},t.default=d},63:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),n=r(s),o=r(i(1)),a=r(i(2));function r(e){return e&&e.__esModule?e:{default:e}}class d extends s.Component{constructor(e){super(e),this.toggleExpandedState=this.toggleExpandedState.bind(this),this.cancelLoadingState=this.cancelLoadingState.bind(this),this.loadMoreSubitems=this.loadMoreSubitems.bind(this),this.handleAfterExpandedStateChange=this.handleAfterExpandedStateChange.bind(this),this.state={isExpanded:!1,isLoading:!1}}cancelLoadingState(){this.setState(()=>({isLoading:!1}))}toggleExpandedState(){this.setState((e,t)=>{const i=!e.isExpanded&&t.childrenCount>t.subitems.length;return{isExpanded:!e.isExpanded,isLoading:i}},this.handleAfterExpandedStateChange)}handleAfterExpandedStateChange(){this.props.childrenCount!==this.props.subitems.length&&(this.state.isLoading?this.loadMoreSubitems():console.log("TODO: Think about killing a request with AbortController"))}loadMoreSubitems(){this.props.loadMoreSubitems({path:this.props.path,parentLocationId:this.props.locationId,offset:this.props.subitems.length,limit:10},this.cancelLoadingState)}checkCanLoadMore(){var e=this.props;const t=e.subitems,i=e.childrenCount;return t.length<i}renderIcon(){var e=this.props;const t=e.contentType,i={extraClasses:`ez-icon--small ez-icon--${e.selected?"light":"dark"}`};return this.state.isLoading?(i.customPath="/bundles/ezplatformadminui/img/ez-icons.svg#spinner",i.extraClasses=`${i.extraClasses} ez-spin`):i.customPath=eZ.helpers.contentType.getContentTypeIconUrl(t.identifier)||eZ.helpers.contentType.getContentTypeIconUrl("file"),n.default.createElement("span",{className:"c-list-item__icon"},n.default.createElement(a.default,i))}renderLoadMoreBtn(){return console.log(!this.state.isExpanded,!this.checkCanLoadMore()),this.state.isExpanded&&this.checkCanLoadMore()?n.default.createElement("button",{type:"button",className:"c-list-item__load-more-btn",onClick:this.loadMoreSubitems},"Load more"):null}render(){var e=this.props;const t=e.childrenCount,i=e.children,s=e.hidden,o=e.selected,a=e.href,r=e.content,d={className:"c-list-item"},l={className:"c-list-item__toggler",onClick:this.toggleExpandedState,tabIndex:-1};return t&&(d.className=`${d.className} c-list-item--has-sub-items`),this.checkCanLoadMore()&&(d.className=`${d.className} c-list-item--can-load-more`),this.state.isExpanded&&(d.className=`${d.className} c-list-item--is-expanded`),s&&(d.className=`${d.className} c-list-item--is-hidden`),o&&(d.className=`${d.className} c-list-item--is-selected`,l.className=`${l.className} c-list-item__toggler--light`),n.default.createElement("li",d,n.default.createElement("div",{className:"c-list-item__label"},n.default.createElement("span",l),n.default.createElement("a",{className:"c-list-item__link",href:a},this.renderIcon()," ",r.name)),i,this.renderLoadMoreBtn())}}d.propTypes={path:o.default.string.isRequired,href:o.default.string.isRequired,contentTypeIdentifier:o.default.string.isRequired,childrenCount:o.default.number.isRequired,subitems:o.default.array.isRequired,children:o.default.element,hidden:o.default.bool.isRequired,selected:o.default.bool.isRequired,content:o.default.shape({name:o.default.string.isRequired,id:o.default.number.isRequired}).isRequired,contentType:o.default.shape({identifier:o.default.string.isRequired,container:o.default.bool.isRequired}).isRequired,locationId:o.default.number.isRequired,loadMoreSubitems:o.default.func.isRequired},d.defaultProps={hidden:!1},t.default=d},64:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadLocationItems=void 0;var s=i(3),n=i(5);t.loadLocationItems=((e,t,i=50,o=0)=>{const a=new Request(`/admin/location/tree/load-subitems/${e}/${i}/${o}`,{method:"GET",mode:"same-origin",credentials:"same-origin"});fetch(a).then(s.handleRequestResponse).then(t).catch(n.showErrorNotification)})}}).default});
//# sourceMappingURL=ContentTree.module.js.map